## 1.5 스프링의 IoC

스프링의 핵심을 담당하는 것은 **빈 팩토리** 또는 **어플리케이션 컨텍스트**라고 불리는 것이다. 이는 우리가 만들었던 `DAOFactory`의 역할을 좀 더 일반화 한 것이다.

### 1.5.1 오브젝트 팩토리를 이용한 스프링 IoC

#### 어플리케이션 컨텍스트와 설정 정보

스프링에서는 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트를 **빈** 이라고 부른다. 오브젝트 단위의 애플리케이션 컴포넌트를 말한다. 
동시에 스프링 빈은 스프링 컨테이너가 생성과 관계 설정, 사용등을 제어해 주는 제어의 역전이 사용된 오브젝트를 가리키는 말이다.

스프링에서 빈의 생성 및 관계 설정을 담당하는 IoC 오브젝트를 **빈 팩토리** 라고 부른다. 다만, 보통은 이를 조금 더 확장한 **어플리케이션 컨텍스트** 라는 이름을 주로 사용한다. 어플리케이션 컨텍스트는 IoC 방식을 따라 만들어진 일종의 빈 팩토리 이다. 둘은 동일하다고 생각해도 괜찮다. 빈 팩토리는 빈을 생성하고 관계를 설정하는 IoC의 기본 기능에 초점을 맞춘 것이고, 어플리케이션 컨텍스트는 어플리케이션 전반에 걸쳐 구성요소의 제어 작업을 담당하는 IoC 엔진이라는 의미가 조금 더 부각된다.

어플리케이션 컨텍스트는 별도의 정보를 참고해 제어 작업을 총괄한다.  

#### DAOFactory를 사용하는 어플리케이션 컨텍스트

`DAOFactory`를 스프링의 빈 팩토리가 사용할 수 있도록 만들어 본다.
먼저, 스프링이 빈 팩토리를 위한 오브젝트 설정을 담당하는 클래스라고 인식할 수 있도록 `@Configuration` 이라는 어노테이션을 추가한다. 그리고, 오브젝트를 만들어 주는 메소드에는 `@Bean` 이라는 어노테이션을 사용한다. 즉, `UserDAO`와 `ConnectionMaker` 오브젝트를 생성해 주는 메소드들에 `@Bean` 어노테이션을 붙여준다.

이제 `DAOFactory`는 스프링 프레임워크의 어플리케이션 컨텍스트가 IoC 방식의 기능을 제공할 때 사용할 수 있는 설정 정보로 사용된다.

아래는 수정 이후의 `DAOFactory`이다. java 코드로 작성 되었지만, XML과 같은 스프링 전용 설정 정보로 동작한다.
```java
//...//
@Configuration
public class DAOFactory{
	@Bean
	public UserDAO userDao(){
		//...//	
	}
	//...//
}
```

이제 `DAOFactory`를 설정 정보로 사용하는 어플리케이션 컨텍스트를 만들어 본다. 
어플리케이션 컨텍스트는 `ApplicationContext` 타입의 오브젝트이다. 여러 구현체 중 `@Configuration` 어노테이션이 붙은 자바 코드를 설정 정보로 사용하려면 `AnnotationConfigApplicationContext`를 이용한다.
어플리케이션 컨텍스트를 생성할 때, 파라미터로 `DAOFactory` 클래스를 넣어 주면 준비된 `ApplicationContext`의 `getBean()`이라는 메소드로 `UserDAO` 등 각각의 오브젝트를 가져올 수 있다.
```java
public class UserDAOTest{
	public static void main()...{
		ApplicationContext context = new 
			AnnotationConfigApplicationContext(DAOFactory.class);

		UserDAO userDao
			 = context.getBean("userDao", UserDAO.class);
	}
}
```

`getBean()` 메서드는 `ApplicationContext`가 관리하는 오브젝트를 요청하는 메서드이다. 첫번째 파라미터는 `ApplicationContext`에 등록된 빈의 이름이다. `DAOFactory`에서 `@Bean` 어노테이션을 `UserDao()` 메서드에 붙였는데, 이 메서드의 이름이 빈의 이름으로 사용된다. 
원래 `getBean()` 메서드는 `Object` 타입을 반환한다. 자바 5 이상의 generic 방식을 사용해 두번째 파라미터로 리턴 타입을 같이 전달해 주어 캐스팅을 직접 진행하지 않고도 원하는 타입의 객체를 반환받을 수 있다.

스프링의 기능을 사용했기 때문에 필요한 라이브러리를 추가해 주는 과정이 진행되어야 한다.

### 1.5.2 애플리케이션 컨텍스트의 동작 방식

기존의 `DAOFactory`, 즉 오브젝트 팩토리를 직접 사용하던 방식과 스프링의 어플리케이션 컨텍스트를 사용한 방식에는 어떤 차이가 있을까?

오브젝트 팩토리에 대응되는 것이 스프링의 애플리케이션 컨텍스트이다. 스프링에서는 이 어플리케이션 컨텍스트를 **IoC 컨테이너**, **빈 팩토리** 또는 **스프링 컨테이너** 라고 부른다. 어플리케이션 컨텍스트는 `ApplicationContext` 인터페이스를 구현하며, `ApplicationContext`는 빈 팩토리가 구현하는 `BeanFactory` 인터페이스를 상속했기 때문에 어플리케이션 컨텍스트 또한 일종의 빈 팩토리이다.

`DAOFactory`는 `UserDAO`를 비롯한 DAO 오브젝트를 생성하고, DB 생성 오브젝트와 관계를 맺어주는 제한적인 역할을 하는 데 비해, 어플리케이션 컨텍스트는 어플리케이션에서 IoC를 적용해서 관리할 모든 오브젝트에 대한 생성과 관계설정을 담당한다. 대신, 직접 오브젝트를 생성하고 관계를 맺어주는 코드가 존재하지 않으며 생성정보와 연관관계 정보를 별도의 설정정보를 통해 얻는다. 때론 외부의 오브젝트 팩토리에 그 작업을 위임하고 결과를 가져다 사용하기도 한다.

어플리케이션 컨텍스트를 사용하는 이유는 범용적이고, 유연한 방법으로 IoC 기능을 확장하기 위함이다. 오브젝트 팩토리를 직접 사용했을 때와 비교해서 어플리케이션 컨텍스트를 사용했을 때 얻을 수 있는 장점은 다음과 같다.

#### 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없다.

어플리케이션의 규모가 커질수록 IoC를 적용한 오브젝트 또한 많아진다. 이 때 클라이언트가 필요한 오브젝트를 가지고 오기 위해선 어떤 팩토리 클래스를 사용해야 하는지 알아야 하며, 필요할 때 마다 팩토리 오브젝트를 생성해야 한다. 
어플리케이션 컨텍스트를 사용하면 각각의 오브젝트 팩토리를 알 필요가 없으며, 일관된 방식으로 원하는 오브젝트를 가지고 올 수 있다. 또, XML과 같은 단순한 방법으로 어플리케이션 컨텍스트가 사용할 IoC 설정 정보를 만들 수 있다.

#### 종합 IoC 서비스를 제공해 준다.

어플리케이션 컨텍스트는 단지 오브젝트의 생성, 다른 오브젝트와의 관계 설정 뿐 아니라 오브젝트가 만들어 지는 방식, 시점과 전략을 다르게 가져갈 수 있으며 자동생성, 오브젝트에 대한 후처리, 정보의 조합 등 오브젝트를 효과적으로 활용할 수 있는 다양한 기능을 제공한다. 또, 빈이 사용할 수 있는 기반 기술 서비스나 외부 시스템과의 연동 등을 컨테이너 차원에서 제공해 주기도 한다.

#### 빈을 검색하는 다양한 방법을 제공한다.

어플리케이션 컨텍스트는 빈의 이름, 타입, 또는 특별한 어노테이션이 설정되어 있는 빈을 찾을수도 있다.

### 1.5.3 스프링 IoC의 용어 정리

**빈**
빈, 또는 빈 오브젝트는 스프링이 IoC 방식으로 관리하는 오브젝트란 뜻이다. 스프링을 사용하는 어플리케이션에서 만들어지는 모든 오브젝트가 빈은 아니며, 그 중에서 스프링이 직접 생성과 제어를 담당하는 오브젝트만을 빈이라고 한다.

**빈 팩토리**
스프링의 IoC를 담당하는 핵심 컨테이너를 가리킨다. 빈을 등록하고, 생성하고, 조회하고, 돌려주는 등 빈을 관리하는 기능을 담당한다. 
보통은 빈 팩토리를 확장한 어플리케이션 컨텍스트를 이용한다.
`BeanFactory` 인터페이스는 빈 팩토리가 구현하고 있는 가장 기본적인 인터페이스이며, 해당 인터페이스에 `getBean()`과 같은 메서드가 정의되어 있다.

**어플리케이션 컨텍스트**
빈 팩토리를 확장한 IoC 컨테이너이다. 기존의 빈 팩토리의 기능에 추가로 스프링이 제공하는 각종 부가 서비스를 제공한다.
`ApplicationContext` 인터페이스는 어플리케이션 컨텍스트가 구현하는 기본 인터페이스이며, `BeanFactory`를 상속한다.

**설정 정보/ 설정 메타 정보**
스프링의 설정 정보란 어플리케이션 컨텍스트가 IoC를 적용하기 위해 사용하는 메타 정보를 말한다. 

**스프링 프레임워크**
IoC 컨테이너, 어플리케이션 컨텍스트를 포함해 스프링이 제공하는 모든 기능을 통틀어 말할때 사용된다.
